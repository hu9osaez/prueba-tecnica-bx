flowchart TD
    User([Usuario abre app]) --> CreateSess[Frontend: POST /sessions]
    CreateSess --> SaveMongo[Backend: Guarda sesión en MongoDB<br/>expira en 1 hora]
    SaveMongo --> GetChar[Frontend: GET /characters/random?sessionId=xxx]
    GetChar --> FindChar[Backend: Busca personaje<br/>NO en excludeIds]
    FindChar --> CheckCache{Revisa cache}
    CheckCache -->|Hit| ReturnCache[Retorna cache]
    CheckCache -->|Miss| FetchAPI[Fetch API externa]
    FetchAPI --> APIs[Rick & Morty / Pokémon / Héroes / StarWars]
    APIs --> ReturnChar[Devuelve personaje]
    ReturnCache --> ReturnChar
    ReturnChar --> Display[Usuario ve personaje]
    Display --> Vote[Usuario vota: POST /votes]
    Vote --> SaveVote[Backend: Guarda voto en MongoDB]
    SaveVote --> UpdateSess[Backend: Agrega ID a excludeIds]
    UpdateSess --> NextChar[Frontend: Pide siguiente personaje]
    NextChar --> GetChar

    style User fill:#e1f5e1
    style Display fill:#fff4e1
